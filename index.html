<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Evaluador Restaurante</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
    label { font-weight: bold; margin-top: 15px; display: block; }
    input[type="number"] { width: 100%; padding: 6px; margin-bottom: 10px; }
    p { margin: 6px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: right; }
    th { background-color: #f2f2f2; }
    td input { width: 60px; }
  </style>
</head>
<body>

<h2>Evaluador de Restaurante</h2>

<label>Ventas Diarias (en millones de CLP):
  <input type="number" id="ventasBase" value="60">
</label>
<p>Ventas mensuales con IVA: $<span id="ventasIVA">-</span></p>
<p>Ventas netas: $<span id="ventasNetas">-</span></p>
<p>Ventas diarias promedio: $<span id="ventasDiarias">-</span></p>

<label>Derecho de Llaves (en millones de CLP):
  <input type="number" id="derechoBase" value="80">
</label>

<label>Remodelación (en millones de CLP):
  <input type="number" id="remodelacionBase" value="40">
</label>

<p>Inversión total: $<span id="inversionMonto">-</span></p>

<label>Arriendo mensual (en millones de CLP):
  <input type="number" id="arriendoBase" value="6">
</label>
<p>Arriendo mensual: $<span id="arriendoMonto">-</span> (<span id="porcArriendo">-</span>% de ventas netas)</p>

<label>Remuneraciones (en millones de CLP):
  <input type="number" id="remuneracionesBase" value="8">
</label>
<p>Remuneraciones: $<span id="remuneracionesMonto">-</span> (<span id="porcRemuneraciones">-</span>% de ventas netas)</p>

<label>% Insumos y producción:
  <input type="number" id="insumosPct" value="38.5" step="0.1">
</label>

<label>% Dieta Directorio:
  <input type="number" id="dietaPct" value="20" step="0.1">
</label>

<label>% Cuentas de Servicios:
  <input type="number" id="serviciosPct" value="3" step="0.1">
</label>

<h3>Gastos calculados</h3>
<p>Arriendo mensual: $<span id="arriendoGasto">-</span> (<span id="porcArriendoGasto">-</span>% de ventas netas)</p>
<p>Remuneraciones: $<span id="remuneracionesGasto">-</span> (<span id="porcRemuneracionesGasto">-</span>% de ventas netas)</p>
<p>Insumos y producción: $<span id="insumos">-</span> (<span id="porcInsumos">-</span>% de ventas netas)</p>
<p>Dieta Directorio: $<span id="dieta">-</span> (<span id="porcDieta">-</span>% de ventas netas)</p>
<p>Cuentas de servicios: $<span id="servicios">-</span> (<span id="porcServicios">-</span>% de ventas netas)</p>

<p><strong>Subtotal de gastos calculados:</strong> $<span id="subtotalGastos">-</span></p>

<h3>Resultados</h3>
<p>Flujo mensual: $<span id="flujoMensual">-</span></p>
<p>Flujo anual ajustado por estacionalidad: $<span id="flujoAnual">-</span></p>
<p>Retorno de inversión (ROI): <span id="roi">-</span>%</p>
<p>Payback: <span id="payback">-</span> meses</p>

<h3>Estacionalidad</h3>
<table>
  <thead>
    <tr>
      <th>Mes</th>
      <th>Días</th>
      <th>%</th>
      <th>Ventas Diarias</th>
      <th>Ventas Mensuales</th>
      <th>Flujo Diario</th>
      <th>Flujo Mensual</th>
    </tr>
  </thead>
  <tbody id="tablaEstacionalidad"></tbody>
  <tfoot>
    <tr>
      <td><strong>Promedio</strong></td>
      <td id="promDias">-</td>
      <td id="promPct">-</td>
      <td id="promVentasDiarias">-</td>
      <td id="promVentasMensuales">-</td>
      <td id="promFlujoDiario">-</td>
      <td id="promFlujoMensual">-</td>
    </tr>
  </tfoot>
</table>

<!-- Nueva sección añadida para ROI y Payback ajustados por estacionalidad -->
<h3>ROI y Payback ajustados por estacionalidad</h3>
<p>ROI ajustado: <span id="roiEstacionalidad">-</span>%</p>
<p>Payback ajustado: <span id="paybackEstacionalidad">-</span> meses</p>

<script>
const estacionalidad = [84, 50, 92, 94, 84, 95, 99, 100, 60, 98, 92, 93];
const meses = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
               'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
const diasPorMes = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

function formatCLP(number) {
  return Number(Math.round(number)).toLocaleString('es-CL');
}

function calcular() {
  const ventasBase = parseFloat(document.getElementById('ventasBase').value) || 0;
  const derechoBase = parseFloat(document.getElementById('derechoBase').value) || 0;
  const remodelacionBase = parseFloat(document.getElementById('remodelacionBase').value) || 0;
  const inversion = (derechoBase + remodelacionBase) * 1_000_000;
  const arriendoBase = parseFloat(document.getElementById('arriendoBase').value) || 0;
  const remuneracionesBase = parseFloat(document.getElementById('remuneracionesBase').value) || 0;

  const insumosPct = parseFloat(document.getElementById('insumosPct').value) || 38.5;
  const dietaPct = parseFloat(document.getElementById('dietaPct').value) || 20;
  const serviciosPct = parseFloat(document.getElementById('serviciosPct').value) || 3;

  const ventasIVA = ventasBase * 1_000_000;
  const ventasNetas = ventasIVA / 1.19;
  const ventasDiarias = ventasNetas / 30;
  const arriendo = arriendoBase * 1_000_000;
  const remuneraciones = remuneracionesBase * 1_000_000;

  const insumos = ventasNetas * (insumosPct / 100);
  const dieta = ventasNetas * (dietaPct / 100);
  const servicios = ventasNetas * (serviciosPct / 100);

  const totalGastos = insumos + remuneraciones + dieta + servicios + arriendo;
  const flujoMensual = ventasNetas - totalGastos;

  let flujoAnual = 0;
  let rows = "";

  // Acumuladores para promedios
  let totalDias = 0, totalPct = 0, totalVentasDia = 0, totalVentasMes = 0;
  let totalFlujoDia = 0, totalFlujoMes = 0;

  estacionalidad.forEach((pct, i) => {
    const dias = diasPorMes[i];
    const ventasMes = ventasNetas * (pct / 100);
    const ventasDia = ventasMes / dias;
    const flujoMes = ventasMes - (
      (ventasMes * (insumosPct / 100)) +
      remuneraciones +
      (ventasMes * (dietaPct / 100)) +
      (ventasMes * (serviciosPct / 100)) +
      arriendo
    );
    const flujoDia = flujoMes / dias;

    flujoAnual += flujoMes;

    totalDias += dias;
    totalPct += pct;
    totalVentasDia += ventasDia;
    totalVentasMes += ventasMes;
    totalFlujoDia += flujoDia;
    totalFlujoMes += flujoMes;

    rows += `
      <tr>
        <td>${meses[i]}</td>
        <td>${dias}</td>
        <td><input type="number" min="0" max="150" value="${pct}" data-index="${i}" class="input-estacionalidad"></td>
        <td>$${formatCLP(ventasDia)}</td>
        <td>$${formatCLP(ventasMes)}</td>
        <td>$${formatCLP(flujoDia)}</td>
        <td>$${formatCLP(flujoMes)}</td>
      </tr>`;
  });

  // Mostrar resultados
  document.getElementById('ventasIVA').textContent = formatCLP(ventasIVA);
  document.getElementById('ventasNetas').textContent = formatCLP(ventasNetas);
  document.getElementById('ventasDiarias').textContent = formatCLP(ventasDiarias);
  document.getElementById('inversionMonto').textContent = formatCLP(inversion);
  document.getElementById('arriendoMonto').textContent = formatCLP(arriendo);
  document.getElementById('porcArriendo').textContent = Math.round((arriendo / ventasNetas) * 100);
  document.getElementById('remuneracionesMonto').textContent = formatCLP(remuneraciones);
  document.getElementById('porcRemuneraciones').textContent = Math.round((remuneraciones / ventasNetas) * 100);

  document.getElementById('insumos').textContent = formatCLP(insumos);
  document.getElementById('dieta').textContent = formatCLP(dieta);
  document.getElementById('servicios').textContent = formatCLP(servicios);

  document.getElementById('arriendoGasto').textContent = formatCLP(arriendo);
  document.getElementById('remuneracionesGasto').textContent = formatCLP(remuneraciones);
  document.getElementById('porcArriendoGasto').textContent = Math.round((arriendo / ventasNetas) * 100);
  document.getElementById('porcRemuneracionesGasto').textContent = Math.round((remuneraciones / ventasNetas) * 100);
  document.getElementById('porcInsumos').textContent = Math.round((insumos / ventasNetas) * 100);
  document.getElementById('porcDieta').textContent = Math.round((dieta / ventasNetas) * 100);
  document.getElementById('porcServicios').textContent = Math.round((servicios / ventasNetas) * 100);

  document.getElementById('subtotalGastos').textContent = formatCLP(totalGastos);
  document.getElementById('flujoMensual').textContent = formatCLP(flujoMensual);
  document.getElementById('flujoAnual').textContent = formatCLP(flujoAnual);

  const roi = (flujoAnual / inversion) * 100;
  const payback = inversion / flujoMensual;
  document.getElementById('roi').textContent = Math.round(roi);
  document.getElementById('payback').textContent = Math.round(payback);

  // Promedios
  const totalMeses = estacionalidad.length;
  document.getElementById('promDias').textContent = Math.round(totalDias / totalMeses);
  document.getElementById('promPct').textContent = Math.round(totalPct / totalMeses);
  document.getElementById('promVentasDiarias').textContent = `$${formatCLP(totalVentasDia / totalMeses)}`;
  document.getElementById('promVentasMensuales').textContent = `$${formatCLP(totalVentasMes / totalMeses)}`;
  document.getElementById('promFlujoDiario').textContent = `$${formatCLP(totalFlujoDia / totalMeses)}`;
  document.getElementById('promFlujoMensual').textContent = `$${formatCLP(totalFlujoMes / totalMeses)}`;

  // ROI y Payback ajustado por estacionalidad
  const roiEstacionalidad = (flujoAnual / inversion) * 100;
  const promedioFlujoMensualEstacional = flujoAnual / 12;
  const paybackEstacionalidad = inversion / promedioFlujoMensualEstacional;

  document.getElementById('roiEstacionalidad').textContent = Math.round(roiEstacionalidad);
  document.getElementById('paybackEstacionalidad').textContent = Math.round(paybackEstacionalidad);

  document.getElementById('tablaEstacionalidad').innerHTML = rows;

  document.querySelectorAll('.input-estacionalidad').forEach(input => {
    input.addEventListener('input', (e) => {
      const index = parseInt(e.target.getAttribute('data-index'));
      const valor = parseFloat(e.target.value) || 0;
      estacionalidad[index] = valor;
      calcular();
    });
  });
}

document.querySelectorAll('input').forEach(input => {
  input.addEventListener('input', calcular);
});

calcular();
</script>

</body>
</html>
